{"version":3,"names":["_isEqual","_reduce","_isEmpty","_differenceWith","ifThen","arrayOperators","array","k","v","push","objectOperators","obj","_diff","base","object","creator","setter","re","vb","tb","to","Array","isArray","avd","length","baseIsEmpty","vd","difference","ops","undefined"],"sources":["diff.js"],"sourcesContent":["import _isEqual from 'lodash/isEqual';\nimport _reduce from 'lodash/reduce';\nimport _isEmpty from 'lodash/isEmpty';\nimport _differenceWith from 'lodash/differenceWith';\n\nimport ifThen from '../lang/ifThen';\n\nconst arrayOperators = [() => [], (array, k, v) => array.push(v)];\nconst objectOperators = [() => ({}), (obj, k, v) => (obj[k] = v)];\n\nfunction _diff(base, object, creator, setter) {\n    return _reduce(\n        object,\n        (re, v, k) => {\n            const vb = base[k];\n            const tb = typeof vb;\n            const to = typeof v;\n\n            if (tb !== to) {\n                // different type at all\n                setter(re, k, v);\n            } else if (typeof vb === 'object') {\n                // both are object\n                if (Array.isArray(vb)) {\n                    // both are array\n                    const avd = _differenceWith(v, vb, _isEqual);\n                    if (avd.length > 0) {\n                        setter(re, k, avd);\n                    }\n                } else if (!_isEqual(vb, v)) {\n                    // object\n                    const baseIsEmpty = _isEmpty(vb);\n\n                    if (_isEmpty(v)) {\n                        if (!baseIsEmpty) {\n                            setter(re, k, v);\n                        }\n                    } else {\n                        if (baseIsEmpty) {\n                            setter(re, k, v);\n                        } else {\n                            // both not empty\n                            const vd = _diff(vb, v, objectOperators[0], objectOperators[1]);\n                            if (!_isEmpty(vd)) {\n                                setter(re, k, vd);\n                            }\n                        }\n                    }\n                }\n            } else if (vb !== v) {\n                setter(re, k, v);\n            }\n\n            return re;\n        },\n        creator()\n    );\n}\n\n/**\n * Deep diff between two object\n * @alias object.difference\n * @param  {Object} base - Object to be compared\n * @param  {Object} object - Object compared\n * @return {Object} Return the key-value pair from object which of the value is different from base with the same key, or undefined if no difference\n */\nfunction difference(base, object) {\n    const ops = Array.isArray(base) ? arrayOperators : objectOperators;\n    const baseIsEmpty = _isEmpty(base);\n    return _isEmpty(object)\n        ? baseIsEmpty\n            ? undefined\n            : object\n        : baseIsEmpty\n        ? object\n        : ifThen(_diff(base, object, ops[0], ops[1]), _isEmpty, undefined);\n}\n\nexport default difference;\n"],"mappings":"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"}