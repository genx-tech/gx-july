{"version":3,"names":["_clone2","_interopRequireDefault","require","_isInteger","_interopRequireWildcard","_set","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","cowSet","collection","keyPath","value","options","numberAsArrayIndex","keyPathSeparator","nodes","Array","isArray","concat","split","length","lastIndex","index","nested","_clone","next","nextKey","isInteger","range","RANGE_INDEX","addEntry","lastKey","_default","exports","module"],"sources":["cowSet.js"],"sourcesContent":["import _clone from 'lodash/clone';\nimport isInteger, { RANGE_INDEX } from '../validators/isInteger';\n\nimport { addEntry } from './set';\n\n// copy on write set\nfunction cowSet(collection, keyPath, value, options) {\n    options = { numberAsArrayIndex: true, keyPathSeparator: '.', ...options };\n\n    if (collection == null || typeof collection !== 'object') {\n        return collection;\n    }\n\n    if (keyPath == null) {\n        return collection;\n    }\n\n    let nodes = Array.isArray(keyPath) ? keyPath.concat() : keyPath.split(options.keyPathSeparator);\n    const length = nodes.length;\n\n    if (length > 0) {\n        const lastIndex = length - 1;\n\n        let index = 0;\n        let nested = _clone(collection);\n        collection = nested;\n\n        while (nested != null && index < lastIndex) {\n            const key = nodes[index++];\n\n            let next = nested[key];\n            if (next == null || typeof next !== 'object') {\n                // peek next node, see if it is integer\n                const nextKey = nodes[index];\n\n                if (options.numberAsArrayIndex && isInteger(nextKey, { range: RANGE_INDEX })) {\n                    next = addEntry(nested, key, [], options.numberAsArrayIndex);\n                } else {\n                    next = addEntry(nested, key, {}, options.numberAsArrayIndex);\n                }\n\n                nested = next;\n            } else {\n                nested[key] = _clone(next);\n                nested = nested[key];\n            }\n        }\n\n        const lastKey = nodes[lastIndex];\n        addEntry(nested, lastKey, value, options.numberAsArrayIndex);\n    }\n\n    return collection;\n}\n\nexport default cowSet;\n"],"mappings":"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"}